<div fxLayout="column">
  <div class="table-heading" *ngIf="heading" fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="start space-between">
    <mat-icon [svgIcon]="heading.icon"></mat-icon>
    <span [attr.aria-label]="heading.label">{{heading.label}}</span>
  </div>
  <div class="table-header" fxFlex="99%" fxLayout="row">
    <span *ngFor="let column of columns" fxFlex>
      {{column.label}}
    </span>
  </div>
  <cdk-virtual-scroll-viewport fxFlex>
    <mat-table [dataSource]="dataSource">
      <mat-row [style.height.px]="itemSize" *matRowDef="let row; columns: displayedColumns"></mat-row>
      <ng-container *ngFor="let column of columns" [matColumnDef]="column.title">
        <mat-cell *matCellDef="let element" fxFlex>
          <ng-container [ngTemplateOutletContext]="{column: column, element: element}"
                        [ngTemplateOutlet]="customColumnMap[column.title] ? customColumnMap[column.title] : cellText"></ng-container>
        </mat-cell>
      </ng-container>
      <ng-container matColumnDef="loading">
        <mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length" fxFlex fxLayoutAlign="center center">
          <mat-spinner [diameter]="30"></mat-spinner>
        </mat-footer-cell>
      </ng-container>
      <mat-footer-row *matFooterRowDef="(dataSource?.loading | async) ? ['loading'] : []"></mat-footer-row>
    </mat-table>
  </cdk-virtual-scroll-viewport>
</div>

<ng-template #cellText let-column="column" let-element="element">
  <span>{{!column.valueTransformer ? element[column.property]: (element | valueTransformer: column)}}</span>
</ng-template>
